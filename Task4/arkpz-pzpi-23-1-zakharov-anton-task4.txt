МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ


ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ

Кафедра «Програмна інженерія»



ЗВІТ
З лаборатоної работи №4 з дисципліни 
«Аналіз та рефакторинг коду»






Виконав:	Перевірив:
ст. гр. ПЗПІ-23-1	ас. кафедри ПІ
Захаров Антон Юрійович	Дашенков Дмитро Сергійович










Харків 2025 

1.	Вступ
1.1.	Тема

Розробка ІоТ клієнта, створення бізнес-логіки та функцій налаштування пристрою системи FarmEnviroControl.
1.2.	Мета

Метою роботи є розробка серверної частини програмної системи FarmEnviroControl для контролю стану умов існування тварин на фермах, а також створення бази даних і прикладного програмного інтерфейсу (API) для взаємодії з клієнтськими додатками.
У межах роботи необхідно реалізувати бізнес-логіку керування користувачами, фермами, тваринами та сповіщеннями, а також забезпечити збереження, обробку та пошук даних у базі даних.

2.	Хід роботи
У ході виконання лабораторної роботи було розроблено IoT-клієнт на базі ESP32, змодельований у середовищі Wokwi, який імітує роботу пристрою моніторингу стану тварин на фермі. Система здійснює збирання даних про температуру та пульс тварини, аналізує отримані значення та визначає загальний стан тварини (Good, Normal, Bad).
У разі виявлення критичних показників система активує локальну сигналізацію за допомогою світлодіода та зумера, а також формує структуровані дані для передачі на сервер FarmEnviroControl. Тестування роботи клієнта здійснювалося через серійний монітор, що дозволило перевірити процес підключення до Wi-Fi, логіку обробки даних та коректність визначення стану тварини. 
2.1.	Текстовий опис інженерних рішень
Програмний код IoT-клієнта реалізовано в Arduino IDE з використанням бібліотек WiFi.h для підключення до бездротової мережі та HTTPClient.h для обміну даними з серверною частиною системи через HTTP API.
У якості апаратної платформи використовується ESP32, яка в середовищі Wokwi імітує роботу реального мікроконтролера. Замість фізичних сенсорів застосовується програмна генерація даних, що моделює показники температури тіла тварини та частоти серцевих скорочень (пульсу).
Основні інженерні рішення включають:
-	підключення ESP32 до Wi-Fi мережі;
-	генерацію температурних та пульсових показників у заданих діапазонах;
-	порівняння отриманих значень із критичними порогами;
-	визначення загального стану тварини;
-	керування світлодіодом та зумером для локального сповіщення;
-	підготовку даних для подальшої передачі на сервер.
 
Рисунок 2.1 – Схема IoT-пристрою.
2.2.	Фрагменти програмного коду наведено у додатку А
2.3.	Налаштування IoT-клієнта
Підключення IoT-клієнта до Wi-Fi мережі забезпечує можливість передачі даних про стан тварин до серверної частини системи FarmEnviroControl. Після ініціалізації ESP32 здійснюється підключення до мережі Wokwi-GUEST з перевіркою статусу з’єднання.
Після успішного підключення запускається основний цикл роботи, у якому з фіксованим інтервалом відбувається генерація показників температури та пульсу тварини. Для кожного параметра визначені критичні порогові значення. У разі перевищення цих меж система переводить стан тварини у режим “Bad” та активує світлову й звукову сигналізацію.
Конфігурація IoT-клієнта дозволяє легко змінювати критичні пороги, інтервал зчитування даних та параметри мережевого з’єднання, що забезпечує гнучкість та адаптацію системи до різних умов експлуатації.
2.4.	UML Діаграми
 
Рисунок 2.2 – UML діаграма прецедентів IoT-клієнта
Діаграма прецедентів демонструє взаємодію IoT-клієнта FarmEnviroControl з користувачем, Wi-Fi мережею, серверною частиною системи та виконавчими пристроями (світлодіодом і динаміком). Основні прецеденти включають підключення до Wi-Fi, генерацію та аналіз показників стану тварини, визначення рівня небезпеки, локальне сповіщення та передачу інформації на сервер.
 
Рисунок 2.3 – UML діаграма діяльності клієнтського модуля FarmEnviroControl
Діаграма діяльності відображає послідовність роботи IoT-клієнта від запуску системи до аналізу та обробки даних. ESP32 ініціалізує периферійні пристрої, підключається до Wi-Fi мережі та переходить у циклічний режим роботи. У циклі відбувається генерація показників температури та пульсу, їх порівняння з пороговими значеннями, визначення стану тварини та активація сигналізації у разі критичного стану. Процес повторюється безперервно, забезпечуючи постійний моніторинг.





3.	Висновки
У ході виконання лабораторної роботи було розроблено IoT-клієнт системи FarmEnviroControl на базі ESP32, змодельований у середовищі Wokwi. Реалізоване рішення забезпечує збір, аналіз та оцінку стану тварин на основі температурних та пульсових показників, а також локальне сповіщення у разі виявлення небезпечних станів.
Використання програмної симуляції сенсорів дозволило відпрацювати логіку моніторингу без застосування фізичного обладнання, що підтверджує ефективність підходу для прототипування IoT-систем. Інтеграція з серверною частиною FarmEnviroControl створює основу для подальшого розвитку системи з можливістю централізованого зберігання даних, аналізу та формування сповіщень.
Розроблений IoT-клієнт може бути використаний як складова частина систем розумного фермерства, забезпечуючи безперервний контроль стану тварин та своєчасне реагування на потенційні загрози.






Додаток А

#include <WiFi.h>
#include <HTTPClient.h>

// ====== PINS ======
#define LED_PIN     2
#define BUZZER_PIN  4

// ====== WIFI ======
const char* ssid = "Wokwi-GUEST";
const char* password = "";

// ====== API ======
const char* apiUrl = "http://localhost:5000/api/sensors";

// ====== LIMITS ======
const float TEMP_CRITICAL = 39.5;
const int   PULSE_CRITICAL = 110;

void setup() {
  Serial.begin(115200);

  pinMode(LED_PIN, OUTPUT);
  pinMode(BUZZER_PIN, OUTPUT);

  digitalWrite(LED_PIN, LOW);
  digitalWrite(BUZZER_PIN, LOW);

  Serial.println("FarmEnviroControl ESP32 Simulator");
  Serial.println("Connecting to WiFi...");

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("\nWiFi connected");
}

void loop() {
  // ====== SIMULATED DATA ======
  float temperature = random(370, 420) / 10.0; // 37.0 - 42.0
  int pulse = random(70, 130);                 // bpm

  bool tempCritical = temperature > TEMP_CRITICAL;
  bool pulseCritical = pulse > PULSE_CRITICAL;

  String state = "GOOD";

  Serial.println("\n----------------------------");
  Serial.print("Temp: ");
  Serial.print(temperature);
  Serial.print(" °C ");

  if (tempCritical) {
    Serial.print("(CRITICAL > ");
    Serial.print(TEMP_CRITICAL);
    Serial.println(")");
  } else {
    Serial.println("(OK)");
  }

  Serial.print("Pulse: ");
  Serial.print(pulse);
  Serial.print(" bpm ");

  if (pulseCritical) {
    Serial.print("(CRITICAL > ");
    Serial.print(PULSE_CRITICAL);
    Serial.println(")");
  } else {
    Serial.println("(OK)");
  }

  // ====== STATE LOGIC ======
  if (tempCritical || pulseCritical) {
    state = "BAD";

    Serial.println("STATE: BAD");
    Serial.println("ALERT: Animal health is CRITICAL");
    Serial.println("Reason:");

    if (tempCritical) Serial.println(" - High temperature");
    if (pulseCritical) Serial.println(" - High pulse");

    digitalWrite(LED_PIN, HIGH);
    tone(BUZZER_PIN, 1000);

    Serial.println("Buzzer: ON");
    Serial.println("LED: ON");
  } else if (temperature >= 38.0) {
    state = "NORMAL";

    Serial.println("STATE: NORMAL");
    Serial.println("Animal condition requires observation");

    digitalWrite(LED_PIN, HIGH);
    delay(200);
    digitalWrite(LED_PIN, LOW);

    noTone(BUZZER_PIN);
    Serial.println("LED: BLINK");
  } else {
    state = "GOOD";

    Serial.println("STATE: GOOD");
    Serial.println("Animal is healthy");

    digitalWrite(LED_PIN, LOW);
    noTone(BUZZER_PIN);
  }

  Serial.println("Sending data to API...");
  Serial.print("State sent: ");
  Serial.println(state);

  delay(5000);
}

Посилання на відео: https://youtu.be/pvLPb7pYnpI